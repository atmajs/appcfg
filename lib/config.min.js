/*!
 * config v0.2.41
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2015
 */
!function(n,t){"use strict";function e(){return t(i,r)}var r,i="undefined"==typeof window||null==window.navigator?global:window;return r=n||i,"function"==typeof define&&define.amd?define(e):(e(),void("undefined"!=typeof module&&(module.exports=r.Config)))}(this,function(n,t){"use strict";var e,r,i,o=Array.prototype.slice;!function(){var t=n;null==t.Class&&n.atma&&(t=n.atma),null==t.Class&&(t=require("atma-libs/exports")),i=n.Class||require("atma-class"),r=require("atma-utils").class_Uri,e=n.io||require("atma-io")}();var a,u;!function(){a=function(){var n=o.call(arguments);n.unshift("<appcfg:error>"),console.error.apply(console,n)},u=function(){var n=o.call(arguments);n.unshift("<appcfg:warn>"),console.warn.apply(console,n)}}();var f,c;!function(){f=function(n){return null!=n&&"number"==typeof n.length&&"function"==typeof n.splice},c=function(n){return null!=n&&"object"==typeof n}}();var l;!function(){var n;l=function(){if(null!=n)return n;for(var t,e,r,i=process.argv,o=i.length,a=2,u={},f=[];o>a;a++)r=i[a],"-"!==r[0]?f.push(r):(t=r.replace(/^[\-]+/,""),o-1>a&&"-"!==i[a+1][0]?(e=i[a+1],a++):e=!0,d(u,t,e));return n={params:u,args:f}}}();var s,d,p,h,g,v,y,w,b;!function(){s=function(n,t){for(var e=t.split("."),r=e.length,i=-1;++i<r;){if(null==n)return null;n=n[e[i]]}return n},d=function(n,t,e){for(var r,i=t.split("."),o=i.length,a=-1;++a<o-1;)r=i[a],null==n[r]&&(n[r]={}),n=n[r];n[i[a]]=e},p=function(n,t){for(var e in t)null==n[e]&&(n[e]=t[e]);return n},h=function(n,t){for(var e in t)null!=t[e]&&(n[e]=t[e]);return n},g=function(n,t){if(null==n&&(n={}),null==t)return n;if(f(n)&&f(t)){for(var e,r=0,i=t.length;i>r;r++)e=t[r],null!=e&&n.push(c(e)?g({},e):e);return n}if(!c(t)&&!c(n))return u("<object:deepExtend> not an object or type missmatch - Dismiss"),n;var o,a;for(o in t)if(a=t[o],33!==o.charCodeAt(0)){if(null!=a)if(null!=n[o])if(f(a)){if(f(n[o])===!1){u("<object:deepExtend> type missmatch %s %s %s - Overwrite",o,a,n[o]),n[o]=a;continue}g(n[o],a)}else c(a)&&c(n[o])?n[o]=g(n[o],a):n[o]=a;else n[o]=a}else n[o.substring(1)]=a;return n},v=function(n,t,e){var r=s(n,t);return null==r?d(n,t,null==e?{}:e):(typeof r!=typeof e&&a("<obj_ensureProperty> type missmatch",typeof r,typeof e,(new Error).stack),r)},y=function(n,t){t=t||n,b(n,function(n,e,r){if(n=n.trim(),35!==n.charCodeAt(0))return null;if(91!==n.charCodeAt(1))return null;n=n.substring(2,n.length-1).trim();var i=s(t,n);return null==i&&u("<config: obj_interpolate: property not exists in root",n),i})},w=function(n){if(null==n||"object"!=typeof n)return n;var t,e=n.constructor;if(Array===e){t=[];for(var r=-1,i=n.length;++r<i;)t[r]=w(n[r]);return t}if(Object===e){t={};for(var o in n)t[o]=w(n[o]);return t}return Date===e||RegExp===e||String===e||Number===e?n:(u("Configuration contains not clonable object",n),n)},function(){function n(n,t,e,r){if(null!=t){if("string"==typeof t)return void(r[e]=n(t,e,r)||t);if("object"==typeof t){if("string"==typeof e&&95===e.charCodeAt(0))return;b(t,n)}}}b=function(t,e){if(null!=t&&"object"==typeof t){if(f(t))for(var r=-1,i=t.length;++r<i;)n(e,t[r],r,t);else for(var o in t)n(e,t[o],o,t)}}}()}();var m,C;!function(){function n(n){var t=process.env,r=t[n];if(null!=r)return r;switch(n){case"TEMP":r=t.TMP||t.TMPDIR;break;case"APP":r=e.env.applicationDir.toLocalDir();break;case"APPDATA":r=t.HOME}return null==r&&a("<config:special-folder> Not resolved",n),C(r||t.HOME||n)}var t=/^%(\w+)%/,r=/[\/]{2,}/g,i={};m=function(e){return t.test(e)===!1?e:(e=C(e).replace(t,function(t,e){return e=e.toUpperCase(),null!=i[e]?i[e]:i[e]=n(e)}).replace(r,"/"),"file://"+e)},C=function(n){return n.replace(/\\/g,"/")}}();var A,D,$,j;!function(){function n(n,t){return r.combine(t,n.substring(1))}A=function(n,t,e){null!=t&&(e&&(n=v(n,e,{})),t=w(t),g(n,t))},D=function(n,t,e,r){r&&(n=v(n,r,{}));var i=e!==!1?g:h;i(n,t)},j=function(t){var e=t.base;b(t,function(t,r,i){return 126!==t.charCodeAt(0)?null:47!==t.charCodeAt(1)?null:n(t,e)})},$=function(t,e){return 126!==t.charCodeAt(0)?t:n(t,e.base)}}();var x,S;!function(){function n(n){f(n)&&e(n),c(n)&&t(n)}function t(t){var e,a,u;for(e in t)u=e.charCodeAt(0),36!==u&&(a=t[e],c(a)!==!1&&(r(e)?o(e)&&g(t,a):i(a)?t[e]=l(a):n(a)))}function e(t){for(var e,r,o=t.length,a=-1;++a<o;)if(e=t[a],c(e)!==!1)if(i(e)){if(r=l(e),null==r)continue;f(r)===!1&&(r=[r]),t.splice.apply(t,[a,1].concat(r)),a--,o+=r.length}else n(e)}function r(n){return 35!==n.charCodeAt(0)?!1:0===n.indexOf("#if ")}function i(n){var t=!1;for(var e in n)if(r(e))t=!0;else if(e!==y)return!1;return t===!0}function o(n){var t=n.replace("#if ","").replace(/\b[\w\d_$]+\b/g,function(n,t,e){return d(e,t)?n:"."===e[t-1]?n:'getter("'+n+'")'}),e=new Function("getter","return !!("+t+")");try{return e(u)}catch(r){a("<config:condition-object> Evalulation error",n,r)}return!1}function u(n){var t=s(h,n);if(null!=t)return t;if(t=s(p,n),null!=t)return t;if("undefined"!=typeof process){var e=process.env;if(t=e[n],null!=t)return t;if(t=e["NODE_"+n],null!=t)return t;var r=e.NODE_ENV||e.ENV;if(null!=r&&r.toUpperCase()===n.toUpperCase())return!0}return null}function l(n){for(var t in n)if(t!==y&&o(t))return n[t];return n[y]}function d(n,t){for(var e,r=!1,i=!1;--t>-1;){if(e=n.charCodeAt(t),34===e){if(i)continue;if(r&&"\\"===n[t-1])continue;r=!r}if(39===e){if(r)continue;if(i&&"\\"===n[t-1])continue;i=!i}}return i||r}x=function(t,e,r){p=e,h=r,n(t)},S=function(n,t){if(v.hasOwnProperty(t))return v[t];var e=s(n,t);if(null!=e)return v[t]=e;if("undefined"!=typeof process){var r=process.env;if(e=r[t],null!=e)return v[t]=e;if(e=r["NODE_"+t.toUpperCase()],null!=e)return v[t]=e;var i=r.NODE_ENV||r.ENV;if(null!=i)return e=new RegExp("\\b"+t+"\\b","i").test(i),v[t]=e}return v[t]=!1};var p,h,v={},y="default"}();var E=function(){var n;!function(){n=function(n,t){var e={exports:{}},r=e.exports;try{new Function("module","exports",t)(e,r)}catch(i){a("<config> Configuration evaluation error",n,i)}return e.exports===r&&0===Object.keys(e.exports).length&&a("<config> Define `module.exports = ` in a file to export configuration",n),e.exports}}();var t,o;!function(){function f(n,t,i){var o=new r(t);return e.File.exists(o)?new e.File(o):o.isRelative()&&"undefined"!=typeof include&&(o=new r(include.location).combine(t),e.File.exists(o))?new e.File(o):(i!==!0&&(a("Configuration file not found",t),u("To dismiss this warning, set `optional:true` in source, if configuration is not strict required")),null)}o=function(t,e,r){var o=new i.Deferred,a=f(t,e,r.optional);return null==a?o.reject({code:404}):(a.readAsync().fail(o.rejectDelegate()).done(function(t){"string"==typeof t&&(r.writable=!1,t=n(a.uri.toLocalFile(),t));var e=r.getterProperty;e&&(t=s(t,e)),o.resolve(t)}),o)},t=function(t,e,r){var i=f(t,e,r.optional);if(null==i)return null;var o=i.read();"string"==typeof o&&(r.writable=!1,o=n(i.uri.toLocalFile(),o));var a=r.getterProperty;return a&&(o=s(o,a)),o}}();var f={},l=i.Collection(Object,{Base:i.Deferred,add:function(n){return n.length&&"function"==typeof n.forEach?void n.forEach(function(n){this.push(n)},this):void this.push(n)},load:function(n,t){function e(){f.load(n,t-1)}function r(n,t,e){return function(){A(e,t.config,t.data.setterProperty),n&&n(t,e)}}var o,a,u,f=this,c=f.length;null==t&&(t=-1);for(var l=0,s=new i.Await;++t<c;){if(o=f[t],++l>1&&o.data.sync){s.always(e);break}a=o.data&&o.data.beforeRead,u=o.data&&o.data.afterRead,a&&a(o,n),o.read(n),o.done(r(u,o,n)).always(s.delegate(null,!1))}return t>c-1&&s.always(f.resolveDelegate()),f}}),d={create:function(n){"string"==typeof n&&(n=[{path:n}]),Array.isArray(n)===!1&&(n=[n]);var t,e,r,i=n.length,o=-1,u=new l;n:for(;++o<i;)if(r=n[o],null!=r){for(e in f)if(t=f[e],t.canHandle(r)){u.add(new t(r));continue n}a("<unhandled configuration source> :",r)}return u},register:function(n,t){f[n]=t}};return function(){function n(n,t){var r=e.File.getHookHandler().getHooksForPath(t,"write");if(0!==r.length)return n;try{return JSON.stringify(n)}catch(i){return n}}d.register("file",i({Base:i.Deferred,Static:{canHandle:function(n){var t=n.path;return"string"!=typeof t?!1:-1!==t.search(/[\*\?]/g)?!1:"/"===t[t.length-1]?!1:!0}},Construct:function(n){this.data=n,this.config={},n.path=m(n.path)},read:function(n){this.defer();var t=this;return o(n,this.data.path,this.data).fail(this.rejectDelegate()).done(function(n){t.config=n,t.resolve(n)}),this},write:function(t,r,i){if(this.defer(),this.data.writable!==!0)return this.reject("Not writable");D(this.config,t,r,i);var o=this.data.path,a=n(this.config,o);return e.File.writeAsync(o,a).pipe(this),this}}))}(),function(){d.register("files",i({Base:i.Deferred,Static:{canHandle:function(n){return Array.isArray(n.files)}},Construct:function(n){var t=f.file;return n.files.map(function(n){return new t({path:n})})}}))}(),function(){d.register("directory",i({Base:i.Deferred,Static:{canHandle:function(n){var t=n.path;return"string"!=typeof t?!1:-1!==t.search(/[\*\?]/g)?!0:"/"===t[t.length-1]?!0:!1}},Construct:function(n){var t,r,i=n.path.replace(/\\/g,"/"),o=i.search(/[\*\?]/g),a=i.lastIndexOf("/",o);-1===o?t=i:(t=i.substring(0,a+1),r=i.substring(a+1));var u=new e.Directory(t).readFiles(r).files.map(function(n){return n.uri.toString()});return d.create([{files:u}]).toArray()}}))}(),function(){function n(n,t){return new(i({Base:i.Serializable,Store:i.MongoStore.Single(n),_id:t}))}d.register("mongo",i({Base:i.Deferred,Static:{canHandle:function(n){return"mongo"in n}},Construct:function(n){this.data=n,this.config={},n.settings&&i.MongoStore.settings(n.settings),null==n.writable&&(n.writable=!0)},read:function(t){var e=t.mongodb;e&&i.MongoStore.settings(e);var r=this;return n(this.data.mongo).fetch().done(function(){r.config=this.toJSON(),r._id=this._id,delete r.config._id,r.resolve()}).fail(function(n){r.reject(n)}),r},write:function(n,t,e){D(this.config,n,t,e);var r=this;return i.MongoStore.resolveCollection(this.data.mongo).done(function(n){n.update({},r.config,{upsert:!0,multi:!1},function(n){return n?r.reject(n):void r.resolve()})}),r}}))}(),function(){d.register("embedded",i({Base:i.Deferred,Static:{canHandle:function(n){return c(n.config)}},Construct:function(n){this.data=n,this.data.writable=!1,this.config=n.config},read:function(){this.resolve()}}))}(),function(){d.register("custom",i({Static:{canHandle:function(n){return"function"==typeof n}},Construct:function(n){return new n}}))}(),d}(),O=i({Base:i.Deferred,Construct:function(n){this.$data=n,this.$sources=E.create(n),this.$parallelReads=new i.Await},Static:{fetch:function(n){return new O(n).$read()},create:function(n){return new O(n)}},$parallelReads:null,$sources:null,$cli:null,$get:function(n){return s(this,n)},$set:function(n,t){d(this,n,t)},$extend:function(n){g(this,n)},$read:function(n){var t=this,e=this.$parallelReads.delegate(null,!1),r=null==n?this.$sources:E.create(n);return this.$parallelReads._always=null,this.$parallelReads.always(this._onComplete),this.$cli=l(),this.defer(),r.load(t).done(function(){var n,r=t.$cli.params;for(n in r)d(t,n,r[n]);y(t),x(t,t,t.$cli.params),j(t),e()}),t},Self:{_onComplete:function(){this.resolve(this)}},$write:function(n,t,e){D(this,n,t,e);for(var r=this.$sources,i=r.length;--i>-1;)if(r[i].data.writable===!0)return this.defer(),n=w(n),r[i].write(n),r[i].pipe(this),this;var o="<config:write> Writable source not defined.";return a(o),this.reject(o)},$is:function(n){return S(this,n)},Override:{toJSON:function(){var n,t=this["super"]();for(n in t)"$"===n[0]&&delete t[n];return t}}});return t.Config=O});
//# sourceMappingURL=config.min.js.map