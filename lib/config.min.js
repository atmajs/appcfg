/*!
 * config v0.2.47
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2018
 */
!function(n,t){"use strict";function e(){return t(i,r)}var r,i="undefined"==typeof window||null==window.navigator?global:window;if(r=n||i,"function"==typeof define&&define.amd)return define(e);e(),"undefined"!=typeof module&&(module.exports=r.Config)}(this,function(n,t){"use strict";var e,r,i,o=Array.prototype.slice;!function(){i=n.Class||require("atma-class"),r=require("atma-utils").class_Uri,e=n.io||require("atma-io")}();var a,u;!function(){a=function(){var n=o.call(arguments);n.unshift("<appcfg:error>"),console.error.apply(console,n)},u=function(){var n=o.call(arguments);n.unshift("<appcfg:warn>"),console.warn.apply(console,n)}}();var f,c;!function(){f=function(n){return null!=n&&"number"==typeof n.length&&"function"==typeof n.splice},c=function(n){return null!=n&&"object"==typeof n}}();var l;!function(){var n;l=function(){if(null!=n)return n;for(var t,e,r,i=process.argv,o=i.length,a=2,u={},f=[];a<o;a++)r=i[a],"-"!==r[0]?f.push(r):(t=r.replace(/^[\-]+/,""),a<o-1&&"-"!==i[a+1][0]?(e=i[a+1],a++):e=!0,d(u,t,e));return n={params:u,args:f}}}();var s,d,h,p,g,v,y,w,b;!function(){s=function(n,t){for(var e=t.split("."),r=e.length,i=-1;++i<r;){if(null==n)return null;n=n[e[i]]}return n},d=function(n,t,e){for(var r,i=t.split("."),o=i.length,a=-1;++a<o-1;)r=i[a],null==n[r]&&(n[r]={}),n=n[r];n[i[a]]=e},h=function(n,t){for(var e in t)null==n[e]&&(n[e]=t[e]);return n},p=function(n,t){for(var e in t)null!=t[e]&&(n[e]=t[e]);return n},g=function(n,t){if(null==n&&(n={}),null==t)return n;if(f(n)&&f(t)){for(var e,r=0,i=t.length;r<i;r++)null!=(e=t[r])&&(c(e)?n.push(g({},e)):n.push(e));return n}if(!c(t)&&!c(n))return u("<object:deepExtend> not an object or type missmatch - Dismiss"),n;var o,a;for(o in t)if(a=t[o],33!==o.charCodeAt(0)){if(null!=a)if(null!=n[o])if(f(a)){if(!1===f(n[o])){u("<object:deepExtend> type missmatch %s %s %s - Overwrite",o,a,n[o]),n[o]=a;continue}g(n[o],a)}else c(a)&&c(n[o])?n[o]=g(n[o],a):n[o]=a;else n[o]=a}else n[o.substring(1)]=a;return n},v=function(n,t,e){var r=s(n,t);return null==r?d(n,t,null==e?{}:e):(typeof r!=typeof e&&a("<obj_ensureProperty> type missmatch",typeof r,typeof e,(new Error).stack),r)},y=function(n,t,e){t=t||n,b(n,function(n,r,i){n=n.trim();var o=n.charCodeAt(0),a=n.charCodeAt(1),f=!1;if(35===o&&91===a&&(u("<APPCFG: OBSOLETE: config interpolation will be changed to ${}",n),f=!0),36===o&&123===a&&(f=!0),!1===f)return null;n=n.substring(2,n.length-1).trim();var c=s(t,n);return null==c&&!0!==e&&u("<config: obj_interpolate: property not exists in root",n),c})},w=function(n){if(null==n||"object"!=typeof n)return n;var t,e=n.constructor;if(Array===e){t=[];for(var r=-1,i=n.length;++r<i;)t[r]=w(n[r]);return t}if(Object===e){t={};for(var o in n)t[o]=w(n[o]);return t}return Date===e||RegExp===e||String===e||Number===e?n:(u("Configuration contains not clonable object",n),n)},function(){function n(n,t,e,r){if(null!=t){if("string"==typeof t)return void(r[e]=n(t,e,r)||t);if("object"==typeof t){if("string"==typeof e&&95===e.charCodeAt(0))return;b(t,n)}}}b=function(t,e){if(null!=t&&"object"==typeof t){if(f(t))for(var r=-1,i=t.length;++r<i;)n(e,t[r],r,t);else for(var o in t)n(e,t[o],o,t)}}}()}();var m,C;!function(){function n(n){var t=process.env,r=t[n];if(null!=r)return r;switch(n){case"TEMP":r=t.TMP||t.TMPDIR;break;case"APP":r=e.env.applicationDir.toLocalDir();break;case"APPDATA":r=t.HOME}return null==r&&a("<config:special-folder> Not resolved",n),C(r||t.HOME||n)}var t=/^%(\w+)%/,r=/[\/]{2,}/g,i={};m=function(e){return!1===t.test(e)?e:"file://"+(e=C(e).replace(t,function(t,e){return e=e.toUpperCase(),null!=i[e]?i[e]:i[e]=n(e)}).replace(r,"/"))},C=function(n){return n.replace(/\\/g,"/")}}();var A,S,$,D;!function(){function n(n,t){return r.combine(t,n.substring(1))}A=function(n,t,e){null!=t&&(e&&(n=v(n,e,{})),t=w(t),g(n,t))},S=function(n,t,e,r){r&&(n=v(n,r,{})),(!1!==e?g:p)(n,t)},D=function(t){var e=t.base;b(t,function(t,r,i){return 126!==t.charCodeAt(0)?null:47!==t.charCodeAt(1)?null:n(t,e)})},$=function(t,e){return 126!==t.charCodeAt(0)?t:n(t,e.base)}}();var x,E;!function(){function n(n){f(n)&&e(n),c(n)&&t(n)}function t(t){if(++y>100){if(-1!==v.indexOf(t))return;v.push(t)}var e,a;for(e in t)36!==e.charCodeAt(0)&&(a=t[e],!1!==c(a)&&(r(e)?o(e)&&g(t,a):i(a)?t[e]=l(a):n(a)))}function e(t){for(var e,r,o=t.length,a=-1;++a<o;)if(e=t[a],!1!==c(e))if(i(e)){if(null==(r=l(e)))continue;!1===f(r)&&(r=[r]),t.splice.apply(t,[a,1].concat(r)),a--,o+=r.length}else n(e)}function r(n){return 35===n.charCodeAt(0)&&0===n.indexOf("#if ")}function i(n){var t=!1;for(var e in n)if(r(e))t=!0;else if(e!==b)return!1;return!0===t}function o(n){var t=n.replace("#if ","").replace(/\b[\w\d_$]+\b/g,function(n,t,e){return d(e,t)?n:"."===e[t-1]?n:'getter("'+n+'")'}),e=new Function("getter","return !!("+t+")");try{return e(u)}catch(t){a("<config:condition-object> Evalulation error",n,t)}return!1}function u(n){var t=s(p,n);if(null!=t)return t;if(null!=(t=s(h,n)))return t;if("undefined"!=typeof process){var e=process.env;if(null!=(t=e[n]))return t;if(null!=(t=e["NODE_"+n]))return t;var r=e.NODE_ENV||e.ENV;if(null!=r&&r.toUpperCase()===n.toUpperCase())return!0}return null}function l(n){for(var t in n)if(t!==b&&o(t))return n[t];return n[b]}function d(n,t){for(var e,r=!1,i=!1;--t>-1;){if(34===(e=n.charCodeAt(t))){if(i)continue;if(r&&"\\"===n[t-1])continue;r=!r}if(39===e){if(r)continue;if(i&&"\\"===n[t-1])continue;i=!i}}return i||r}x=function(t,e,r){h=e,p=r,y=0,v=[],n(t)},E=function(n,t){if(w.hasOwnProperty(t))return w[t];var e=s(n,t);if(null!=e)return w[t]=e;if("undefined"!=typeof process){var r=process.env;if(null!=(e=r[t]))return w[t]=e;if(null!=(e=r["NODE_"+t.toUpperCase()]))return w[t]=e;var i=r.NODE_ENV||r.ENV;if(null!=i)return e=new RegExp("\\b"+t+"\\b","i").test(i),w[t]=e}return w[t]=!1};var h,p,v,y,w={},b="default"}();var j=function(){var t;!function(){t=function(n,t){var e={exports:{}},r=e.exports;try{new Function("module","exports",t)(e,r)}catch(t){a("<config> Configuration evaluation error",n,t)}return e.exports===r&&0===Object.keys(e.exports).length&&a("<config> Define `module.exports = ` in a file to export configuration",n),e.exports}}();var o,f;!function(){function c(t,i,o,f){var c=new r(i);if("yml"===c.extension&&"yml"in e.File.middleware==!1&&require("atma-io-middleware-yml"),e.File.exists(c))return new e.File(c);if(c.isRelative()&&"undefined"!=typeof include&&(c=new r(include.location).combine(i),e.File.exists(c)))return new e.File(c);if(f){!1===c.isRelative()&&(c=new r(n.process.cwd()).combine(c));for(var i=c.path();c.cdUp()&&c.path!==i;)if(i=c.path,e.File.exists(c))return new e.File(c)}return!0!==o&&(a("Configuration file not found",i),u("To dismiss this warning, set `optional:true` in source, if configuration is not strict required")),null}function l(n,e,r){var i;"string"==typeof r?(n.writable=!1,i=t(e.uri.toLocalFile(),r)):i=r,y(i,i,!0);var o=n.getterProperty;return o&&(i=s(i,o)),i}f=function(n,t,e){var r=new i.Deferred,o=c(n,t,e.optional,e.lookupAncestors);return null==o?r.reject({code:404}):(o.readAsync().fail(r.rejectDelegate()).done(function(n){r.resolve(l(e,o,n))}),r)},o=function(n,t,e){var r=c(n,t,e.optional);return null==r?null:l(e,r,r.read())}}();var l={},d=i.Collection(Object,{Base:i.Deferred,add:function(n){if(n.length&&"function"==typeof n.forEach)return void n.forEach(function(n){this.push(n)},this);this.push(n)},loadSync:function(n){var t=this,e=-1,r=t.length;for(new i.Await;++e<r;){var o=t[e],a=o.data&&o.data.beforeRead,u=o.data&&o.data.afterRead;if(a&&a(o,n),null==o.readSync)throw new Error("Source not supports sync config loader");o.readSync(n),A(n,o.config,o.data.setterProperty),u&&u(o,n)}return t},load:function(n,t){function e(){f.load(n,t-1)}function r(n,t,e){return function(){A(e,t.config,t.data.setterProperty),n&&n(t,e)}}var o,a,u,f=this,c=f.length;null==t&&(t=-1);for(var l=0,s=new i.Await;++t<c;){if(o=f[t],++l>1&&o.data.sync){s.always(e);break}a=o.data&&o.data.beforeRead,u=o.data&&o.data.afterRead,a&&a(o,n),o.read(n),o.done(r(u,o,n)).always(s.delegate(null,!1))}return t>c-1&&s.always(f.resolveDelegate()),f}}),h={create:function(n){"string"==typeof n&&(n=[{path:n}]),!1===Array.isArray(n)&&(n=[n]);var t,e,r,i=n.length,o=-1,u=new d;n:for(;++o<i;)if(null!=(r=n[o])){for(e in l)if(t=l[e],t.canHandle(r)){u.add(new t(r));continue n}a("<unhandled configuration source> :",r)}return u},register:function(n,t){l[n]=t}};return function(){function n(n,t){if(0!==e.File.getHookHandler().getHooksForPath(t,"write").length)return n;try{return JSON.stringify(n)}catch(t){return n}}h.register("file",i({Base:i.Deferred,Static:{canHandle:function(n){var t=n.path;return"string"==typeof t&&(-1===t.search(/[\*\?]/g)&&"/"!==t[t.length-1])}},Construct:function(n){this.data=n,this.config={},n.path=m(n.path)},read:function(n){this.defer();var t=this;return f(n,this.data.path,this.data).fail(this.rejectDelegate()).done(function(n){t.config=n,t.resolve(n)}),this},readSync:function(n){return this.config=o(n,this.data.path,this.data)},write:function(t,r,i){if(this.defer(),!0!==this.data.writable)return this.reject("Not writable");S(this.config,t,r,i);var o=this.data.path,a=n(this.config,o);return e.File.writeAsync(o,a).pipe(this),this}}))}(),function(){h.register("files",i({Base:i.Deferred,Static:{canHandle:function(n){return Array.isArray(n.files)}},Construct:function(n){var t=l.file;return n.files.map(function(n){return new t({path:n})})}}))}(),function(){h.register("directory",i({Base:i.Deferred,Static:{canHandle:function(n){var t=n.path;return"string"==typeof t&&(-1!==t.search(/[\*\?]/g)||"/"===t[t.length-1])}},Construct:function(n){var t,r,i=n.path.replace(/\\/g,"/"),o=i.search(/[\*\?]/g),a=i.lastIndexOf("/",o);-1===o?t=i:(t=i.substring(0,a+1),r=i.substring(a+1));var u=new e.Directory(t).readFiles(r).files.map(function(n){return n.uri.toString()});return h.create([{files:u}]).toArray()}}))}(),function(){function n(n,t){return new(i({Base:i.Serializable,Store:i.MongoStore.Single(n),_id:t}))}h.register("mongo",i({Base:i.Deferred,Static:{canHandle:function(n){return"mongo"in n}},Construct:function(n){this.data=n,this.config={},n.settings&&i.MongoStore.settings(n.settings),null==n.writable&&(n.writable=!0)},read:function(t){var e=t.mongodb;e&&i.MongoStore.settings(e);var r=this;return n(this.data.mongo).fetch().done(function(){r.config=this.toJSON(),r._id=this._id,delete r.config._id,r.resolve()}).fail(function(n){r.reject(n)}),r},write:function(n,t,e){S(this.config,n,t,e);var r=this;return i.MongoStore.resolveCollection(this.data.mongo).done(function(n){n.update({},r.config,{upsert:!0,multi:!1},function(n){if(n)return r.reject(n);r.resolve()})}),r}}))}(),function(){h.register("embedded",i({Base:i.Deferred,Static:{canHandle:function(n){return c(n.config)}},Construct:function(n){this.data=n,this.data.writable=!1,this.config=n.config},read:function(){this.resolve()}}))}(),function(){h.register("custom",i({Static:{canHandle:function(n){return"function"==typeof n}},Construct:function(n){return new n}}))}(),h}(),O=i({Base:i.Deferred,Construct:function(n,t){this.$data=n,this.$sources=j.create(n),this.$parallelReads=new i.Await,this.$self=t},Static:{fetch:function(n,t){return new O(n,t).$read()},create:function(n){return new O(n)}},$parallelReads:null,$sources:null,$cli:null,$get:function(n){return s(this,n)},$set:function(n,t){d(this,n,t)},$extend:function(n){g(this,n)},$read:function(n){function t(){var n,t=e.$cli.params;for(n in t)d(e,n,t[n]);y(e),x(e,e,e.$cli.params),D(e),r()}var e=this,r=this.$parallelReads.delegate(null,!1),i=null==n?this.$sources:j.create(n);return this.$parallelReads._always=null,this.$parallelReads.always(this._onComplete),this.$cli=l(),this.defer(),this.$self&&this.$self.sync?(i.loadSync(e),t()):i.load(e).done(t),e},Self:{_onComplete:function(){this.resolve(this)}},$write:function(n,t,e){S(this,n,t,e);for(var r=this.$sources,i=r.length;--i>-1;)if(!0===r[i].data.writable)return this.defer(),n=w(n),r[i].write(n),r[i].pipe(this),this;var o="<config:write> Writable source not defined.";return a(o),this.reject(o)},$is:function(n){return E(this,n)},Override:{toJSON:function(){var n,t=this.super();for(n in t)"$"===n[0]&&delete t[n];return t}}});return t.Config=O});
//# sourceMappingURL=config.min.js.map